<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calvin Real Estate Agencies</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
    <nav>
        <h1>Calvin Real Estate Agencies</h1>
        <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#about">About Us</a></li>
            <li><a href="#properties">Properties</a></li>
            <li><a href="#contact">Contact</a></li>
            <li><a href="/admin" style="color: #ffcc00;">Admin</a></li>
        </ul>
    </nav>
</header>

<section class="hero" id="home">
    <h2>Your Dream Home Awaits</h2>
    <p>Find the perfect property with Calvin Real Estate Agencies.</p>
    <a href="#properties" class="btn-hero">View Properties</a>
</section>

<section id="about">
    <h2>About Us</h2>
    <p>We specialize in connecting clients with the best properties in town, offering expert advice and reliable services.</p>
</section>

<section id="properties">
    <h2>Featured Properties</h2>
    <div class="property-grid">
        {% if properties %}
            {% for p in properties %}
            <article class="property-card">
                <img src="{{ url_for('static', filename=p.image) }}" alt="{{ p.title }}">
                <h3>{{ p.title }}</h3>
                <p>{{ p.details }}</p>
                <p><strong>{{ p.price }}</strong></p>
                <a href="/delete-property/{{ p.id }}" style="color:red; font-size:0.7rem; text-decoration:none;">[Remove Listing]</a>
            </article>
            {% endfor %}
        {% else %}
            <p style="text-align:center;">No listings available. Visit the Admin page to add some!</p>
        {% endif %}
    </div>
</section>

<section id="contact">
    <h2>Contact Us</h2>
    <p>üìû Call us at <strong>0796250286</strong></p>
    <form id="contactForm">
        <label for="name">Your Name</label>
        <input type="text" id="name" placeholder="Your Name" required>

        <label for="email">Your Email</label>
        <input type="email" id="email" placeholder="Your Email" required>

        <label for="message">Message</label>
        <textarea id="message" placeholder="Your Message"></textarea>

        <button type="submit">Send Message</button>
    </form>
    <div id="toast" class="toast"></div>
</section>

<footer>
    <p>&copy; 2025 Calvin Real Estate Agencies | All Rights Reserved</p>
    <p><address>üìç Nairobi, Kenya</address></p>
</footer>

<script>
/* Fade-in animation on scroll */
document.addEventListener('DOMContentLoaded', () => {
    const faders = document.querySelectorAll('.property-card');
    const appearOptions = { threshold: 0.1, rootMargin: "0px 0px -50px 0px" };
    const appearOnScroll = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (!entry.isIntersecting) return;
            entry.target.style.opacity = 1;
            entry.target.style.transform = 'translateY(0)';
            observer.unobserve(entry.target);
        });
    }, appearOptions);
    faders.forEach(fader => appearOnScroll.observe(fader));
});

/* Async Contact Form */
const form = document.getElementById('contactForm');
const toast = document.getElementById('toast');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        message: document.getElementById('message').value
    };
    try {
        const res = await fetch('/contact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        const result = await res.json();
        showToast("Message Sent!");
        form.reset();
    } catch(err) {
        showToast('Something went wrong.', true);
    }
});

function showToast(msg, error=false){
    toast.textContent = msg;
    toast.style.display = 'block';
    toast.style.background = error ? 'red' : '#001f3f';
    setTimeout(() => toast.style.display = 'none', 3000);
}
</script>

</body>
</html>