<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#050505" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f5f5f5" media="(prefers-color-scheme: light)">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <title>Calvin Real Estate: Elite Estates</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lenis@latest/dist/lenis.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <style>
        :root { --gold: #D4AF37; --dark: #050505; }
        body { font-family: 'Montserrat', sans-serif; }
        .text-gold { color: var(--gold); }
        .bg-gold { background-color: var(--gold); }
        .border-gold { border-color: var(--gold); }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .hero { background-attachment: fixed; background-size: cover; background-position: center; }
        @media (max-width: 768px) { .hero { background-attachment: scroll; } }
        @media (prefers-reduced-motion: reduce) { * { transition: none !important; animation: none !important; } }
    </style>
</head>
<body class="bg-[var(--dark)] text-white min-h-screen">
    <header class="sticky top-0 z-50 bg-[var(--dark)]/90 backdrop-blur border-b border-gray-800">
        <nav class="max-w-7xl mx-auto flex justify-between items-center p-4" aria-label="Main navigation">
            <h1 class="text-3xl font-cinzel text-gold">Calvin Real Estate</h1>
            <button id="hamburger" aria-controls="nav-menu" aria-expanded="false" class="md:hidden text-4xl">‚ò∞</button>
            <ul id="nav-menu" class="hidden md:flex md:space-x-8 uppercase text-sm tracking-wider">
                <li><a href="#home" class="hover:text-gold">Home</a></li>
                <li><a href="#about" class="hover:text-gold">About</a></li>
                <li><a href="#properties" class="hover:text-gold">Properties</a></li>
                <li><a href="#gallery" class="hover:text-gold">Gallery</a></li>
                <li><a href="#contact" class="hover:text-gold">Contact</a></li>
            </ul>
            <button id="theme-toggle" aria-label="Toggle theme" class="text-2xl">üåô</button>
        </nav>
    </header>

    <section id="home" class="hero h-screen flex items-center justify-center text-center relative" style="background-image: url('https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=1920');">
        <div class="bg-black/60 p-8 rounded-lg max-w-2xl mx-4">
            <h2 class="text-5xl md:text-7xl font-cinzel text-gold mb-6">Your Legacy Awaits</h2>
            <p class="text-lg md:text-xl mb-8">Curated estates for the unparalleled elite.</p>
            <a href="#properties" class="inline-block border border-gold text-gold px-8 py-4 uppercase tracking-wider hover:bg-gold hover:text-black transition">View Collection</a>
        </div>
    </section>

    <section id="properties" class="py-16 px-4 max-w-7xl mx-auto">
        <h2 class="text-4xl font-cinzel text-gold text-center mb-12">Featured Estates</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for listing in featured %}
            <article class="bg-black/40 p-6 rounded-lg fade-in">
                <picture>
                    <source srcset="{{ listing.image_url }}?auto=compress&cs=tinysrgb&w=400" media="(max-width: 600px)">
                    <img src="{{ listing.image_url }}?auto=compress&cs=tinysrgb&w=800" alt="{{ listing.title }}" loading="lazy" class="w-full h-64 object-cover rounded mb-4">
                </picture>
                <h3 class="text-2xl font-cinzel text-gold">{{ listing.title }}</h3>
                <p class="text-gold my-2">{{ listing.price }} KSh ‚Ä¢ {{ listing.location }}</p>
                <p class="text-sm opacity-80">{{ listing.bedrooms }} Beds ‚Ä¢ {{ listing.bathrooms }} Baths ‚Ä¢ {{ listing.sqm }} SQM</p>
                {% if maps_key %}
                <iframe class="w-full h-64 mt-4 rounded" loading="lazy" src="https://www.google.com/maps/embed/v1/place?key={{ maps_key }}&q={{ listing.location|urlencode }}" allowfullscreen></iframe>
                {% endif %}
            </article>
            {% endfor %}
        </div>
    </section>

    <section id="gallery" class="py-16 px-4 bg-black/20">
        <h2 class="text-4xl font-cinzel text-gold text-center mb-12">Exclusive Gallery</h2>
        <div id="gallery-swiper" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8 overflow-x-auto snap-x snap-mandatory">
            {% for listing in gallery %}
            <article class="snap-center fade-in">
                <img src="{{ listing.image_url }}?auto=compress&cs=tinysrgb&w=600" alt="{{ listing.title }}" loading="lazy" class="w-full h-80 object-cover rounded">
                <h3 class="text-xl font-cinzel text-gold mt-4">{{ listing.title }}</h3>
                <p class="text-gold">{{ listing.price }} KSh</p>
            </article>
            {% endfor %}
        </div>
    </section>

    <section id="contact" class="py-16 px-4 max-w-2xl mx-auto text-center">
        <h2 class="text-4xl font-cinzel text-gold mb-12">Private Inquiry</h2>
        <form id="contactForm" class="space-y-6">
            <input type="text" id="name" placeholder="Name" class="w-full bg-transparent border border-gray-600 p-4 rounded text-white" required>
            <input type="email" id="email" placeholder="Email" class="w-full bg-transparent border border-gray-600 p-4 rounded text-white" required>
            <textarea id="message" placeholder="Your Vision" rows="5" class="w-full bg-transparent border border-gray-600 p-4 rounded text-white" required></textarea>
            <button type="submit" class="w-full bg-gold text-black py-4 font-bold uppercase tracking-wider">Submit Inquiry</button>
        </form>
        <div id="toast" class="fixed bottom-8 right-8 bg-gold text-black px-6 py-4 rounded shadow-lg hidden">Message sent!</div>
    </section>

    <div class="spinner fixed inset-0 bg-[var(--dark)] flex items-center justify-center hidden">
        <p class="text-2xl">Curating your legacy... üï∞Ô∏è</p>
    </div>

    <script>
        // Theme system + persistence
        const toggle = document.getElementById('theme-toggle');
        const body = document.body;
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
        if (savedTheme === 'light') body.classList.add('light', 'bg-gray-100', 'text-black');
        toggle.textContent = body.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô';
        toggle.addEventListener('click', () => {
            body.classList.toggle('light');
            body.classList.toggle('bg-gray-100');
            body.classList.toggle('text-black');
            localStorage.setItem('theme', body.classList.contains('light') ? 'light' : 'dark');
            toggle.textContent = body.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô';
        });

        // Hamburger
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('nav-menu');
        hamburger.addEventListener('click', () => {
            const expanded = hamburger.getAttribute('aria-expanded') === 'true';
            hamburger.setAttribute('aria-expanded', !expanded);
            navMenu.classList.toggle('hidden');
            navMenu.classList.toggle('flex');
            navMenu.classList.toggle('flex-col');
            navMenu.classList.toggle('absolute');
            navMenu.classList.toggle('top-16');
            navMenu.classList.toggle('left-0');
            navMenu.classList.toggle('w-full');
            navMenu.classList.toggle('bg-[var(--dark)]');
            navMenu.classList.toggle('p-8');
            hamburger.textContent = expanded ? '‚ò∞' : '‚úï';
        });

        // Lenis smooth scroll
        const lenis = new Lenis({ smoothTouch: true });
        function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
        requestAnimationFrame(raf);

        // Fades
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

        // Gallery swipe
        const gallery = document.getElementById('gallery-swiper');
        const hammer = new Hammer(gallery);
        hammer.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL });
        hammer.on('panleft panright', e => {
            gallery.scrollBy({ left: e.deltaX - e.additionalDeltaX, behavior: 'smooth' });
        });

        // Toast
        const toast = document.getElementById('toast');
        const form = document.getElementById('contactForm');
        form.addEventListener('submit', async e => {
            e.preventDefault();
            // Your async fetch here
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 4000);
        });

        // PWA SW
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }

        // Offline spinner (witty)
        if (!navigator.onLine) document.querySelector('.spinner').classList.remove('hidden');
    </script>
</body>
</html>